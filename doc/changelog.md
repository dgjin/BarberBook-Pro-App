# 系统更新日志 (Changelog)

## v1.5.6 (2024-03-28)
### 理发师工作台统计系统重构
- **全量后端对账**: 彻底弃用前端静态累计，改为通过 Supabase 对 `app_appointments` 表进行实时 `Count` 和 `Sum` 聚合。
- **核心指标精准化**: “今日完结订单”和“今日流水营收”现在直接映射数据库中当日 `status='completed'` 的真实记录，确保数据绝对严谨。
- **生涯成就对账修复**: 修复了“品牌职业成就”在某些情况下显示为空或无法加载的问题。通过优化 `fetchData` 异步流和增加 Mock 历史数据，实现了生涯服务人次的精准溯源。
- **视觉体验优化**: 在数据统计看板增加了数字格式化处理（toLocaleString）和加载态动画，确保数据同步过程中的视觉平滑度。

---

## v1.5.5 (2024-03-27)
### 语音播报引擎迁移
- **科大讯飞集成**: 正式将监控大屏的语音叫号引擎从 Gemini TTS 迁移至**科大讯飞 (iFLYTEK)**。
- **音质大幅提升**: 针对中文环境优化了分词、多音字及语调处理，播报声音更自然、专业。
- **技术细节**: 采用了 WebSocket 流式传输与 16kHz PCM 高保真解码，显著降低了播报延迟。
- **状态显示**: 在 WebMonitor 界面增加了“讯飞语音引擎”状态标识，提升系统专业感。

---

## v1.5.4 (2024-03-27)
### 理发师工作台优化
- **单号识别强化**: 在理发师工作台的队列中，客户预约单号 (ID) 现以高对比度的“票据式”标签展示，并配有识别图标。
- **界面美化**: 优化了待服务序列的卡片布局，提升了信息层级感。
### 语音播报系统升级
- **音质与播报逻辑**: 优化了叫号播报的触发时机与音质平衡。针对专业理发环境，调整了 TTS 播报的语速与语调。

---

## v1.5.3 (2024-03-26)
### 工作台体验优化
- **单号可视化**: 在理发师工作台的“今日队列”和“当前服务”中增加了显著的预约单号徽章（#ID）。
- **状态联动**: 优化了工作台在服务完成后的状态切换逻辑。
### 语音播报修复
- **WebMonitor 增强**: 修复了部分浏览器下音频上下文无法自动激活的问题。

---

## v1.5.2 (2024-03-26)
- **文档完善**: 更新了《详细设计说明书》，详细描述了理发券的实时聚合算法、订单取消时的自动退券冲正机制以及排班日历的技术实现细节。

---

## v1.5.1 (2024-03-25)
### 财务安全强化
- **取数逻辑重构**: 理发师“累计理发券收入”现已由静态存储改为**动态实时聚合**。
- **UI 防篡改设计**: 管理后台收入字段改为“只读卡片”，管理员仅能点击同步对账，无法手动修改。
- **性能优化**: 优化了管理端加载流程，引入了精细的 `animate-fade-in` 视觉过渡。

---

## v1.5.0 (2024-03-24)
### 核心业务逻辑升级
- **理发券闭环优化**: 实现了自动对账与冲正逻辑，预约取消时会自动退回理发券并同步冲减理发师业绩。
- **数据一致性增强**: 在工作台完成服务时，理发师 ID 匹配逻辑更加严格，防止重名导致的数据污染。